name: Pipeline CI/CD

on:
  push:
    branches: [ main ]
  schedule:
    - cron: '0 * * * *'  # Ejecutar cada hora

jobs:
  build-and-deploy:
    runs-on: ubuntu-latest

    steps:
    - name: Clonar repositorio
      uses: actions/checkout@v2

    - name: Configurar Docker Buildx
      uses: docker/setup-buildx-action@v1

    - name: Construir imagen Docker
      run: docker build --tag webserver2 .

    - name: Ejecutar contenedor Docker
      run: docker run -d --name servidor_web -v webvol:/var/www/html/ webserver2

    - name: Etiquetar imagen Docker
      run: docker tag webserver2:latest ykzagorgonita/desafio13:v3

    - name: Iniciar sesi√≥n en Docker Hub
      uses: docker/login-action@v1
      with:
        username: ${{ secrets.NAME }}
        password: ${{ secrets.PASS }}

    - name: Subir a Docker Hub
      run: docker push ykzagorgonita/desafio13:v3

    - name: Prueba
      run: curl http://localhost:8080
